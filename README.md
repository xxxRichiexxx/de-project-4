# Проект 4
### Задание
Необходимо реализовать витрину для расчётов с курьерами:
рассчитать суммы оплаты каждому курьеру за предыдущий месяц. Например, в июне выплачиваем сумму за май. Расчётным числом является 10-е число каждого месяца.

Состав витрины:
* id — идентификатор записи.
* courier_id — ID курьера, которому перечисляем.
* courier_name — Ф. И. О. курьера.
* settlement_year — год отчёта.
* settlement_month — месяц отчёта, где 1 — январь и 12 — декабрь.
* orders_count — количество заказов за период (месяц).
* orders_total_sum — общая стоимость заказов.
* rate_avg — средний рейтинг курьера по оценкам пользователей.
* order_processing_fee — сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum * 0.25.
* courier_order_sum — сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга (см. ниже).
* courier_tips_sum — сумма, которую пользователи оставили курьеру в качестве чаевых.
* courier_reward_sum — сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum * 0.95 (5% — комиссия за обработку платежа).

Правила расчёта процента выплаты курьеру в зависимости от рейтинга, где r — это средний рейтинг курьера в текущем месяце:
* r < 4 — 5% от заказа, но не менее 100 руб.;
* 4 <= r < 4.5 — 7% от заказа, но не менее 150 руб.;
* 4.5 <= r < 4.9 — 8% от заказа, но не менее 175 руб.;
* 4.9 <= r — 10% от заказа, но не менее 200 руб.

Данные курьерской службы необходимо забрать из API курьерской службы.

### Спецификация API
	GET /restaurants
		Метод /restaurants возвращает список доступных ресторанов (_id, name).
	GET /couriers
		Метод /couriers используется для того, чтобы получить список курьеров с учётом фильтров
	GET / deliveries
		Метод /deliveries используется для того, чтобы получить список совершённых доставок с учётом фильтров, переданных в запросе
			* sort_field — необязательный параметр. Возможные значения: _id, name. Если указать _id, то сортировка будет применяться к ID заказа (order_id). 
				Если указать date, то сортировка будет применяться к дате создания заказа (order_ts).
			* restaurant_id — ID ресторана. Если значение не указано, то метод вернёт данные по всем доступным в БД ресторанам.
			* from и to — параметры фильтрации. В выборку попадают заказы с датой доставки между from и to.

### Как запустить контейнер
Запустите локально команду:

```
docker run \
-d \
-p 3000:3000 \
-p 3002:3002 \
-p 15432:5432 \
--mount src=airflow_sp5,target=/opt/airflow \
--mount src=lesson_sp5,target=/lessons \
--mount src=db_sp5,target=/var/lib/postgresql/data \
--name=de-sprint-5-server-local \
sindb/de-pg-cr-af:latest
```

После того как запустится контейнер, вам будут доступны:
- Airflow
	- `localhost:3000/airflow`
- БД
	- `jovyan:jovyan@localhost:15432/de`
